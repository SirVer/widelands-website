{% extends 'wiki/base.html' %}
{% load i18n %}
{% load wlimages %}

{% block title %}
{% trans "Editing article" %} - {{ block.super }}
{% endblock %}

{% block content %}
   <script type="text/javascript">
      $(document).ready(
            function() {
               // Insert rendered markup for preview
               $("#id_preview").click(function(){ 
                  // Activate preview
                  $("#preview").html("<h1>Preview</h1>\n<hr>\n<div class=\"wiki_article\" id=\"content_preview\">Loading...</div>\n<hr>");
                  
                  $("#content_preview").load( "{% url wiki_preview %}", 
                     {"body": $("#id_content").val(),
                     });
               })
               
               {% ifequal new_article 0 %} 
               // Insert diff  
               $("#id_diff").click(function(){ 
                  // Activate preview
                  $("#diff").html("<h1>Diff</h1>\n<hr>\n<div id=\"content_diff\">Loading...</div>\n<hr>");
                  
                  $("#content_diff").load( "{% url wiki_preview_diff %}", 
                     {"body": $("#id_content").val(),
                     "article": {{ object_id }}, 
                     });
               })
               {%endifequal%}
            }
            );
   </script>

	<h1>{% trans "Edit" %}</h1>
   
   <p>
   You can edit the wiki pages contents using the Syntax described on the 
   <a href="/wiki/WikiSyntax">WikiSyntax</a>.
   </p>

   <div id="preview"></div>

   <div id="diff"></div>

   <form action="" method="post">
      <table id="edit_wiki_page_form">
         <!-- Title -->
         <tr>
            <th><label for="id_title">{% trans "Title" %}:</label></th>
            <td>{{ form.title.errors }}{{ form.title }}</td>
         </tr>
         
         <!-- Content -->
         <tr><th colspan="2"><label for="id_content">{% trans "Content" %}:</label></th></tr>
         <tr><td colspan="2" >{{ form.content.errors }}{{ form.content }}</td></tr>
         
         <!-- Summary -->
         <tr><th colspan="2"><label for="id_summary">{% trans "Page Summary" %}:</label></th></tr>
         <tr><td colspan="2" >{{ form.summary.errors }}{{ form.summary }}</td></tr>
         
         <!-- Comment -->
         <tr><th colspan=2><label for="id_comment">{% trans "Comment for this revision" %}:</label></th></tr>
         <tr><td colspan=2 >{{ form.comment.errors }}{{ form.comment }}</td></tr>
         
      </table>
         <!-- Markup as hidden element -->
         <input type="hidden" name="markup" value="mrk" />
         {{ form.content_type }}
         {{ form.object_id }}
         {{ form.action }}
         {{ form.user_ip }}
      
		<div class="submit">
			<input id="id_preview" type="button" value="{% trans "Preview" %}" />
         {% ifequal new_article 0 %}
			<input id="id_diff" type="button" value="{% trans "Diff" %}" />
         {% endifequal %}
         <br/>
			<input type="submit" value="{% trans "Save" %}" />
		</div>
   </form> 
   
   
   {% if new_article %}
      <h2>Images</h2>
      You must save the article once before you can attach images to it
   {% else %}
      {% if images.count %}
         <h2>Images</h2>
         Images attached to this article:
         <table width="100%">
         <tr>
            <th>Image Title</th>
            <th>Image</th>
            <th>Code to include</th>
         </tr>
         {% for img in images %}
         <tr>
            <td>{{ img.name }}</td>
            <td><img src="{{ img.url }}"></td>
            <td>![{{img.name}}]({{ img.url }})</td>
         </tr>
         {% endfor %}
         </table>
      {%endif%}

      {% get_upload_form as iform %}
      <form  enctype="multipart/form-data" action="/images/upload/{{content_type}}/{{object_id}}/{{request.path}}" method="POST">
           {{ iform.as_p }}
         <div class="submit">
            <input type="submit" value="{% trans "Upload Image" %}" />
         </div>
      </form>
   
   {% endif%}

{% endblock %}

