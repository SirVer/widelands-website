{% load i18n %}

{% comment %}
This template is used to prevent using same code
in different parent templates.
{% endcomment %}

{% block extra_head %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/disableOnSubmit.js"></script>
<script type="text/javascript">
	$(function() {
		$('form').disableOnSubmit();
		$('.post-form .preview-button').click(function() {
			var raw_content = $.trim($('.post-form #id_body').val());
			var markup = $('.post-form #id_markup').val();

			args = {'content': raw_content, 'markup': markup}
			$.post('{% url 'pybb_post_ajax_preview' %}', args, function(data) {
				if (data.error) {
					alert(data.error);
				} else {
					$('.preview-box .content').html(data.content);
					$('.preview-box').show();
				}
			}, 'json');
		});
	});
</script>
{% endblock %}

{# HMTL included to parent templates, no block tag #}
	<div class="preview-box" style="display: none">
		{% trans "Preview" %}:<br />
		<div class="content post">
		</div>
		<br />
	</div>

	<div class="posRight">
		<a href="/wiki/WikiSyntax" title="Opens new Tab/Window" target="_blank">
			<img src="{{ MEDIA_URL }}img/menu_help.png" alt="Help on Syntax" class="middle">
			Help on Syntax
		</a>
	</div>
	
	<form class="post-form" action="{{ form_url }}" method="post" enctype="multipart/form-data">
	{{ form.as_p }}
	{% csrf_token %}
	<button type="submit">
		<img src="{{ MEDIA_URL }}forum/img/send.png" alt ="" class="middle" />
		<span class="middle">{% trans "Send" %}</span>
	</button>
	<button type="button" class="preview-button">
		<img src="{{ MEDIA_URL }}forum/img/preview.png" alt ="" class="middle" />
		<span class="middle">{% trans "Preview" %}</span>
	</button>
	</form>
