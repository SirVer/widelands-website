{% extends 'pybb/base.html' %}
{% load pybb_extras %}
{% load i18n %}
{% load humanize %}
{% load wiki %}
{% load wlprofile %}
{% load custom_date %}

{% block title %}
{{Â topic.name }} - {{ topic.forum.name }} - {{ block.super }}
{% endblock title %}

{% block extra_head %}
<link rel="alternate" type="application/atom+xml" title="Latest Posts on forum '{{ topic.forum.name }}'" href="{% url pybb_feed "posts" %}{{topic.forum.id}}/"  />
<link rel="alternate" type="application/atom+xml" title="Latest Topics on forum '{{ topic.forum.name }}'" href="{% url pybb_feed "topics"%}{{topic.forum.id}}/" />
{{ block.super }}
{% endblock %}

{% block content %}
<h1>Topic: {{ topic }}</h1>
<div class="blogEntry">
	<a href="{% url pybb_index %}">Forums</a> &#187; 
	{% pybb_link topic.forum.category %} &#187; 
	<a href="{{ topic.forum.get_absolute_url }}">{{ topic.forum.name }}</a> &#187;
	{{ topic }}
	<br /><br />
	<div class="posRight">
	{% if moderator %}
		{% if topic.sticky %}
		<button onclick="window.location.href='{% url pybb_unstick_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/unstick.png" alt ="" class="middle" />
			<span class="middle">{% trans "Unstick topic" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_stick_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/sticky.png" alt ="" class="middle" />
			<span class="middle">{% trans "Stick topic" %}</span>
		</button>
		{% endif %}
		{% if topic.closed %}
		<button onclick="window.location.href='{% url pybb_open_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/open.png" alt ="" class="middle" />
			<span class="middle">{% trans "Open topic" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_close_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/closed.png" alt ="" class="middle" />
			<span class="middle">{% trans "Close topic" %}</span>
		</button>
		{% endif %}
	{% endif %}
	{% if user.is_authenticated %}
		{% if subscribed %}
		<button onclick="window.location.href='{% url pybb_delete_subscription topic.id %}?from_topic';">
			<img src="{{MEDIA_URL}}/forum/img/unsubscribe.png" alt ="" class="middle" />
			<span class="middle">{% trans "Unsubscribe" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_add_subscription topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/subscribe.png" alt ="" class="middle" />
			<span class="middle">{% trans "Subscribe" %}</span>
		</button>
		{% endif %}
		<button onclick="window.location.href='{% url pybb_add_post topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/send.png" alt ="" class="middle" />
			<span class="middle">{% trans "New reply" %}</span>
		</button>
	{% endif %}
	</div>
	{% pybb_pagination _('Posts') %}
	<br /><br />

	{% comment %}
    <div class="posts" style="clear:left">
    {% if first_post %}
        {% ifnotequal first_post posts.0 %}
            {% with first_post as post %}
        <div class="post first_post">
                {% include "pybb/inlines/post.html" %}
        </div>
            {% endwith %}
        {% endifnotequal %}
    {% endif %}
    {% for post in posts %}
        <div class="post">
        {% include "pybb/inlines/post.html" %}
        </div>
    {% endfor %}
    </div>
	{% endcomment %}

	<a id="top"></a>
	<table class="forum">
		<tbody>
	{% for post in posts %}
		<tr class="{% cycle 'odd' 'even' %}">
			<td class="author">
				{{ post.user|user_link }}<br />
				{% if post.user.wlprofile.avatar %}
				<a href="{% url profile_view post.user %}">
					<img src="{{ post.user.wlprofile.avatar.url }}" alt="Avatar" />
				</a>
				{% endif %}
				<div class="authorStats">
				<strong>Joined:</strong> {{ post.user.date_joined|custom_date:user|title }}<br />
				<strong>Posts:</strong> {{ post.user.wlprofile.post_count }}<br />
				<img src="{{ MEDIA_URL }}img/{{ post.user.wlprofile.user_status.image }}" alt="Ranking" /><br />
				<strong>{{ post.user.wlprofile.user_status.text }}</strong><br />
				{% if post.user.wlprofile.location %}
				<strong>Location:</strong> {{ post.user.wlprofile.location }}<br />
				{% endif %}
				{% if post.user.wlprofile.get_ggzstats and post.user.wlprofile.get_ggzstats.ranking %} 
				<strong>GGZ ranking:</strong> {{ post.user.wlprofile.get_ggzstats.ranking|floatformat }}<br />
				<strong>GGZ rating:</strong> {{ post.user.wlprofile.get_ggzstats.rating|floatformat }}<br />
				<strong>GGZ win:</strong> {{ post.user.wlprofile.get_ggzstats.wins|floatformat }}<br />
				<strong>GGZ loses:</strong> {{ post.user.wlprofile.get_ggzstats.losses|floatformat }}<br />
				{% endif %}
				</div>
			</td>
			<td class="post">
				<a id="post-{{ post.id }}" href="{{post.get_absolute_url}}" title="{% trans "Permalink" %}" class="posRight small permalink">&nbsp;</a>
				<span class="small">Posted at: {{ post.created|custom_date:user}}</span>
				<hr />
				<div class="post">
					{{ post.body_html|safe }}
				</div>

				{% if post.attachment_cache %}
					{% for attach in post.attachment_cache %}
						{% trans "Attachment" %}: <a href="{{ attach.get_absolute_url }}">{{ attach.name }}</a> ({{ attach.size_display }})
					{% endfor %}
				{% endif %}

				{% if post.updated %}
					<span class="small">{% trans "Edited" %}: {{ post.updated|custom_date:user|title}}</span>
				{% endif %}
				<hr />
				{% if user.is_authenticated %}
					{% ifequal user.wlprofile.show_signatures 1 %}
						{% if post.user.wlprofile.signature %}
							{{ post.user.wlprofile.signature|urlize|linebreaks }}
						{% endif %}
					{% endifequal %}
				{% else %}
					{% if post.user.wlprofile.signature %}
						{{ post.user.wlprofile.signature|urlize|linebreaks }}
					{% endif %}
				{% endif %}

				<button onclick="window.location.href='#top';" class="posRight">
					<img src="{{MEDIA_URL}}/forum/img/top.png" alt ="" class="middle" />
					<span class="middle">{% trans "Top" %}</span>
				</button>

				<button onclick="window.location.href='{% url pybb_add_post topic.id %}?quote_id={{ post.id }}';">
					<img src="{{MEDIA_URL}}/forum/img/quote.png" alt ="" class="middle" />
					<span class="middle">{% trans "Quote" %}</span>
				</button>
				{% if moderator or post|pybb_posted_by:user %}
					<button onclick="window.location.href='{% url pybb_edit_post post.id %}';">
						<img src="{{MEDIA_URL}}/forum/img/edit.png" alt ="" class="middle" />
						<span class="middle">{% trans "Edit" %}</span>
					</button>
					{% if moderator or post|pybb_equal_to:last_post %}
					<button onclick="window.location.href='{% url pybb_delete_post post.id %}';">
						<img src="{{MEDIA_URL}}/forum/img/delete.png" alt ="" class="middle" />
						<span class="middle">{% trans "Delete" %}</span>
					</button>
					{% endif %}
				{% endif %}
			</td>
		</tr>
		<tr class="spacer">
			<td></td>
			<td></td>
		</tr>
	{% endfor %}
		</tbody>
	</table>

	<div class="posRight">
	{% if moderator %}
		{% if topic.sticky %}
		<button onclick="window.location.href='{% url pybb_unstick_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/unstick.png" alt ="" class="middle" />
			<span class="middle">{% trans "Unstick topic" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_stick_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/sticky.png" alt ="" class="middle" />
			<span class="middle">{% trans "Stick topic" %}</span>
		</button>
		{% endif %}
		{% if topic.closed %}
		<button onclick="window.location.href='{% url pybb_open_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/open.png" alt ="" class="middle" />
			<span class="middle">{% trans "Open topic" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_close_topic topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/closed.png" alt ="" class="middle" />
			<span class="middle">{% trans "Close topic" %}</span>
		</button>
		{% endif %}
	{% endif %}
	{% if user.is_authenticated %}
		{% if subscribed %}
		<button onclick="window.location.href='{% url pybb_delete_subscription topic.id %}?from_topic';">
			<img src="{{MEDIA_URL}}/forum/img/unsubscribe.png" alt ="" class="middle" />
			<span class="middle">{% trans "Unsubscribe" %}</span>
		</button>
		{% else %}
		<button onclick="window.location.href='{% url pybb_add_subscription topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/subscribe.png" alt ="" class="middle" />
			<span class="middle">{% trans "Subscribe" %}</span>
		</button>
		{% endif %}
		<button onclick="window.location.href='{% url pybb_add_post topic.id %}';">
			<img src="{{MEDIA_URL}}/forum/img/send.png" alt ="" class="middle" />
			<span class="middle">{% trans "New reply" %}</span>
		</button>
	{% endif %}
	</div>
	{% pybb_pagination _('Posts') %}
	<br />
</div>

{% if user.is_authenticated %}
	{% if not topic.closed %}
		{% include "pybb/inlines/add_post_form.html" %}
	{% endif %}
{% endif %}

{% endblock %}
