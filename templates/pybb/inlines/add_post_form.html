{% load i18n %}
{% block extra_head %}
<script type="text/javascript" src="/wlmedia/js/disableOnSubmit.js"></script>
<script type="text/javascript">
   $(function() {
         $('form').disableOnSubmit();
   });
</script>
{{ block.super }}
{% endblock %}
    <form class="post-form" action="{{ form_url }}" method="post" enctype="multipart/form-data">
        <div class="preview-box" style="display: none">
            <div class="header">
                <h3 class="title">{% trans "Preview" %}</h3>
            </div>
            <div class="content">
            </div>
        </div>
        <h3 class="title">
    {% if forum %}
        {% trans "New topic" %}
    {% else %}
        {%if post %}
            {% trans "Edit reply" %}
        {% else %}
            {% trans "New reply" %}
        {% endif %}
    {% endif %}
        </h3>
        <div class="content">
            {{ form.as_p }}
	    </div>
        <div class="info_line show_left">
            <input type="submit" value="{% trans "Submit" %}" />
            <input class="preview-button" type="button" value="{% trans "Preview" %}" />
        </div>
    </form>
<script type="text/javascript">
$(function() {
    $('.post-form .preview-button').click(function() {
        var raw_content = $.trim($('.post-form #id_body').val());
        var markup = $('.post-form #id_markup').val();

        args = {'content': raw_content, 'markup': markup}
        $.post('{% url pybb_post_ajax_preview %}', args, function(data) {
            if (data.error) {
                alert(data.error);
            } else {
                $('.preview-box .content').html(data.content);
                $('.preview-box').show();
            }
        }, 'json');
    });
});

</script>
