{% comment %}
   vim:ft=htmldjango
{% endcomment %}

{% load wlprofile %}
{% load threadedcomments_tags %}

	{% include "threadedcomments/inlines/reply_to.js" %}

	{% for comment in comment_list|fill_tree|annotate_tree %}
		{% ifchanged comment.parent_id %}{% else %}</li>{% endifchanged %}
		{% if not comment.open and not comment.close %}</li>{% endif %}
		{% if comment.open %}<ul>{% endif %}
	
		<li id="c{{ comment.id }}">
			...
		{% for close in comment.close %}</li></ul>{% endfor %}
	{% endfor %}

	{% comment %}
	{% get_threaded_comment_form as form %}
	{% get_threaded_comment_tree for object as tree %}
	{% for comment in tree %}
		<div id="c{{ comment.id }}" class="comment {% cycle "odd" "even" %}" style="margin-left: {{ comment.depth }}cm;">
			<table>
				<tr>
					<td class="author" rowspan="2">
						{% if comment.user.wlprofile.avatar %}
						<a href="{% url profile_view comment.user %}">
							<img style="width: 50px; height: 50px;" src="{{ comment.user.wlprofile.avatar.url }}" />
						</a>
						<br />
						{% endif %}
						<span class="small">{{ comment.user|user_link }}</span>
					</td>
					<td class="text">
						{% auto_transform_markup comment %}
					</td>
				</tr>
				<tr>
					<td class="reply_link small">
						{% if user.is_authenticated %}
						<a href="javascript:show_reply_form('c{{ comment.id }}','{% get_comment_url object comment %}', {{ comment.depth }})">Reply</a>
						{% endif %}
					</td>
				</tr>
			</table>
		</div>
	{% endfor %}
	{% endcomment %}
	<br />
{% comment franku check if needed wehn logins is possible%}
	<h3 class="title">Reply to Original:</h3>
	{% if user.is_authenticated %}        
	<form method="POST" action="{% get_comment_url object %}?next={{object.get_absolute_url}}">
		<span class="errormessage">{{ form.comment.errors }}</span>
		{{ form.comment }}
		<br />
		<input type="hidden" name="markup" value="1" />
		<input type="hidden" value="next" value="{{ object.get_absolute_url }}" />
		<input type="submit" value="Submit Comment" />
		{% csrf_token %}
	</form>
	{% else %}
	<p>
		<a href="{% url auth_login %}?next={{ request.path }}">Log in</a> to post comments!
	</p>
	{% endif %}
{% endcomment %}