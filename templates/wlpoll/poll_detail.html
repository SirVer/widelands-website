{% extends "wlpoll/base.html" %}
{% comment %}
   vim:ft=htmldjango
{% endcomment %}

{% load wlpoll wlprofile %}
{% load threadedcommentstags custom_date %}

{% block title %}{{ object.name }} - {{ block.super }}{% endblock %}

{% block content %}
<br />
<div class="poll">
   <h3 class="title">{{ object.name }}</h3>
   <div class="info_line"> 
      <span class="post_date">Posted on {{ object.pub_date|custom_date:user }}</span> 
   </div>
   <div class="content">
      <div class="poll_plot">
      {% display_poll object %}
      </div>
   </div>

   <table class="bottom_line" width="100%">
      <tr>
      {% get_comment_count for object as ccount %}
      <td class="comments">
         <a href="{{ object.get_absolute_url }}">{{ ccount }} comments, {{object.total_votes}} votes</a>
      </td>
      
      <td class="admin">
      {% if perms.news %}
      {% if perms.news.poll_can_add %}<a href="/admin/wlpoll/poll/add/">Add New Poll</a>{% endif %}
      {% if perms.news.poll_can_edit %}| <a href="/admin/wlpoll/poll/{{object.id}}/">Edit</a>{% endif %}
      {% if perms.news.poll_can_delete %}| <a href="/admin/wlpoll/poll/{{object.id}}/delete/">Delete</a>{% endif %}
      {% endif %}
      </td>

      <!-- Third column for the style -->
      <td>
      </td>
  </tr>
  </table>
</div>
      

<!-- Comments below -->
{% get_threaded_comment_form as form %}
{% include "threadedcomments/inlines/reply_to.js" %}

<h3>Comments on this Poll:</h3>
{% get_threaded_comment_tree for object as tree %}
{% for comment in tree %}
  <div style="margin-left: {{ comment.depth }}em;" class="comment {% cycle "odd" "even" %}">
      {% if comment.user.wlprofile.avatar %}
      <span class="avatar" style="margin: 2px; margin-right: 10px; float: left;">
          <a href="{% url profile_view comment.user %}">
          <img src="{{ comment.user.wlprofile.avatar.url }}" />
          </a>
      </span>
      {% endif %}
      <p class="author">{{ comment.user|user_link }} said:</p>
      {% auto_transform_markup comment %}
      {% if user.is_authenticated %}
      <p><a id="c{{ comment.id }}" href="javascript:show_reply_form('c{{ comment.id }}','{% get_comment_url object comment %}','{{ comment.user.username }}')">Reply</a></p>
      {% endif %}
  </div>
{% endfor %}
{% if user.is_authenticated %}
<p>Reply to Original:</p>
<form method="post" action="{% get_comment_url object %}">
<div class="comment_post">
    <div class="comment">
       <span class="errorclass">{{ form.comment.errors }}</span>
      {{ form.comment }}
    </div>
   <input type="hidden" name="markup" value="1" />
   <input type="submit" value="Submit Comment" />
</div>
</form>
{% else %}
<p>Log in to post comments</p>
{% endif %}





{% endblock %}
